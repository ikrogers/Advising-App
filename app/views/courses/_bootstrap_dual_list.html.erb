


<% @courselist = Courselist.all() %>
<% @currentuser = User.find_by_id(session[:user_id]) %>
<% @sql = "SELECT CL.name FROM courselists CL EXCEPT SELECT C.name FROM courses C WHERE (C.studentid = #{@currentuser.id} OR C.studentid = -1) EXCEPT SELECT DISTINCT X.name FROM courselists X, courses C WHERE  X.prereq NOT IN(SELECT  CC.name FROM courses CC WHERE (CC.studentid = #{@currentuser.id} OR CC.studentid = -1))" %>
<% result = ActiveRecord::Base.connection.raw_connection.prepare(@sql) %>
<% result.execute() %>
 
<% @filter_course_array = result %>




<% @ccc =  Courselist.all%>
<table>
<%= form_tag("/getcourse", :method => "post", :id => "contactForm") do %>
    <%=  select_tag "list", options_for_select(@filter_course_array), :multiple=>true %> <br/>
  </br>
  <br>
	<div>
		<%= label_tag "Appoitment"%>
		<br>
		<%= text_field_tag "appt"%>
	</div>
<br>
	<div>
		<%= label_tag "Message"%>
		<br>
		<%= text_area_tag "msg"%>
	</div>
    <%= submit_tag "Send", :class => "btn btn-default btn-block" %>
<% end %>
<div id="result">
</div>
</table>

<script>

function loop()
	{
		
		var list = document.getElementById('bootstrap-duallistbox-selected-list_list[]');
		var array = new Array();
		for(var i = 0; i < list.options.length; ++i){
			//if(list.options[i].selected)
				array[i] = list.options[i].value;
				
		}//end for
		 //window.open("localhost:3000//controller/courses."+
		
		return array;
	}


$("#contactForm").submit(function(event) {



	/* stop form from submitting normally */
	event.preventDefault();

	/* clear result div */
	$("#result").html('');

	var msg = document.getElementById("msg").value;
	var appt = document.getElementById("appt").value;
	/* get values from elements on the page: */
	var values = loop();
	/* Send the data using post and put the results in a div */
	$.ajax({
		url: "/getcourse",
		type: "post",
		data: {param1:values; param2:msg; param3:appt},
		success: function(data, textStatus, xhr){
		      alert("Courses submitted successfully!");
		      $("#result").html();
		      location.reload(true);
		},

		error:function(){
			$("#result").html('there is error while submit');
		}
	});
});
</script>



<script>

 
 
    $(function () {
        $('#list')
                .bootstrapDualListbox({
                    bootstrap2Compatible: false,
                    moveAllLabel: 'MOVE ALL',
                    removeAllLabel: 'REMOVE ALL',
                    moveSelectedLabel: 'MOVE SELECTED',
                    removeSelectedLabel: 'REMOVE SELECTED',
                    filterPlaceHolder: 'FILTER',
                    filterSelected: '2',
                    filterNonSelected: '1',
                    moveOnSelect: true,
                    preserveSelectionOnMove: 'all',
                    helperSelectNamePostfix: '_myhelper',
                    selectedListLabel: 'Your Choices',
                    nonSelectedListLabel: 'Available Classes'
                })
                .bootstrapDualListbox('setMoveAllLabel', 'Choose all')
                .bootstrapDualListbox('setRemoveAllLabel', 'Reset choices')
                .bootstrapDualListbox('setSelectedFilter', undefined)
                .bootstrapDualListbox('setNonSelectedFilter', undefined)
                .bootstrapDualListbox('refresh')
                
    });

          
</script>

<br>
</body>
